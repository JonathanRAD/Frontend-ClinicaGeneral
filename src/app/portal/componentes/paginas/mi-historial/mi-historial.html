<div class="historial-imprimible">

  <div class="print-header">
    <h1>Clínica Bienestar - Historial Clínico</h1>
  </div>

  <div class="container mt-4 historial-page">
    <div class="page-header">
      <h1 class="page-title">Mi Panel de Salud</h1>
      <button mat-raised-button color="primary" (click)="imprimirHistorial()">
        <mat-icon>print</mat-icon>
        <span>Imprimir / Guardar como PDF</span>
      </button>
    </div>

    <div *ngIf="cargando()" class="spinner-container">
      <app-spinner></app-spinner>
      <p class="mt-2 text-muted">Cargando tu historial...</p>
    </div>
    <div *ngIf="error() && !cargando()" class="alerta-error">
      {{ error() }}
    </div>

    <div *ngIf="!cargando() && historia() as hist" class="fade-in">
      
      <div class="key-conditions-grid">
        <mat-card class="condition-card allergy-card">
          <mat-card-header>
            <mat-icon mat-card-avatar>warning</mat-icon>
            <mat-card-title>Alergias</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p>{{ hist.alergias || 'No se han registrado alergias.' }}</p>
          </mat-card-content>
        </mat-card>

        <mat-card class="condition-card chronic-card">
          <mat-card-header>
            <mat-icon mat-card-avatar>monitor_heart</mat-icon>
            <mat-card-title>Enfermedades Crónicas</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p>{{ hist.enfermedadesCronicas || 'No se han registrado enfermedades crónicas.' }}</p>
          </mat-card-content>
        </mat-card>
        
        <mat-card class="condition-card history-card">
          <mat-card-header>
            <mat-icon mat-card-avatar>assignment</mat-icon>
            <mat-card-title>Antecedentes</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p>{{ hist.antecedentes || 'No se han registrado antecedentes.' }}</p>
          </mat-card-content>
        </mat-card>
      </div>

      <div class="timeline-container">
        <h2 class="timeline-header">Historial de Consultas</h2>
        <mat-accordion multi *ngIf="hist.consultas && hist.consultas.length > 0; else noConsultas">
          <div *ngFor="let consulta of hist.consultas" class="timeline-item">
            <div class="timeline-dot"></div>
            <mat-expansion-panel class="consulta-panel">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>event</mat-icon>
                  <span>{{ consulta.fechaConsulta | date:'fullDate':'':'es' }}</span>
                </mat-panel-title>
              </mat-expansion-panel-header>

              <div class="consulta-contenido">
                <div class="detalle-consulta detalle-medico">
                  <strong>Atendido por:</strong>
                  <p>Dr(a). {{ consulta.medico.nombres }} {{ consulta.medico.apellidos }} ({{ consulta.medico.especialidad }})</p>
                </div>
                <mat-divider></mat-divider>
                <div class="detalle-consulta"><strong>Motivo:</strong><p>{{ consulta.motivo }}</p></div>
                <mat-divider></mat-divider>
                <div class="detalle-consulta"><strong>Diagnóstico:</strong><p>{{ consulta.diagnostico }}</p></div>
                <mat-divider></mat-divider>
                <div class="detalle-consulta"><strong>Tratamiento:</strong><p>{{ consulta.tratamiento }}</p></div>
              </div>
            </mat-expansion-panel>
          </div>
        </mat-accordion>
        <ng-template #noConsultas>
          <div class="no-citas"><mat-icon>folder_off</mat-icon><h2>Sin Consultas</h2><p>Aún no tienes consultas registradas en tu historial.</p></div>
        </ng-template>
      </div>
    </div>
  </div>
</div>