<div class="container mt-4 mi-perfil-page">
  <div class="page-header">
    <h1 class="page-title">Mi Perfil</h1>
  </div>

  <div *ngIf="cargando()" class="spinner-container">
    <app-spinner></app-spinner>
    <p class="mt-2 text-muted">Cargando tu información...</p>
  </div>

  <div *ngIf="error() && !cargando()" class="alerta-error">
    {{ error() }}
  </div>

  <div *ngIf="!cargando() && !error()" class="fade-in">
    <div class="row g-4">

      <div class="col-lg-4">
        <mat-card class="profile-avatar-card text-center">
          <mat-card-content>
            <div class="avatar-container mb-3">
              <mat-icon class="profile-avatar-icon">account_circle</mat-icon>
              <button mat-icon-button class="edit-avatar-button">
                <mat-icon>photo_camera</mat-icon>
              </button>
            </div>
            <h2 class="profile-name">{{ formularioPerfil.get('nombres')?.value }} {{ formularioPerfil.get('apellidos')?.value }}</h2>
            <p class="profile-email text-muted">{{ formularioPerfil.get('email')?.value }}</p>
            <mat-divider></mat-divider>
            <button mat-stroked-button class="mt-4" (click)="abrirDialogoContrasena()">
              <mat-icon>lock_reset</mat-icon>
              Cambiar Contraseña
            </button>
          </mat-card-content>
        </mat-card>
      </div>

      <div class="col-lg-8">
        <form [formGroup]="formularioPerfil" (ngSubmit)="guardarCambios()">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Información Personal y Médica</mat-card-title>
              <mat-card-subtitle>Mantén tus datos actualizados para una mejor atención.</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="row g-3">
                <div class="col-md-6">
                  <mat-form-field appearance="outline">
                    <mat-label>Nombres</mat-label>
                    <input matInput formControlName="nombres" readonly>
                  </mat-form-field>
                </div>
                <div class="col-md-6">
                  <mat-form-field appearance="outline">
                    <mat-label>Apellidos</mat-label>
                    <input matInput formControlName="apellidos" readonly>
                  </mat-form-field>
                </div>
                <div class="col-md-6">
                  <mat-form-field appearance="outline">
                    <mat-label>DNI</mat-label>
                    <input matInput formControlName="dni">
                  </mat-form-field>
                </div>
                <div class="col-md-6">
                  <mat-form-field appearance="outline">
                    <mat-label>Teléfono</mat-label>
                    <input matInput formControlName="telefono">
                  </mat-form-field>
                </div>
                <div class="col-md-6">
                  <mat-form-field appearance="outline">
                    <mat-label>Fecha de Nacimiento</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="fechaNacimiento">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                  </mat-form-field>
                </div>
                <div class="col-md-6">
                  <mat-form-field appearance="outline">
                    <mat-label>Dirección</mat-label>
                    <input matInput formControlName="direccion">
                  </mat-form-field>
                </div>
                <div class="col-md-6">
                  <mat-form-field appearance="outline">
                    <mat-label>Peso (kg)</mat-label>
                    <input matInput type="number" formControlName="peso">
                  </mat-form-field>
                </div>
                <div class="col-md-6">
                  <mat-form-field appearance="outline">
                    <mat-label>Altura (m)</mat-label>
                    <input matInput type="number" step="0.01" formControlName="altura">
                  </mat-form-field>
                </div>
              </div>
            </mat-card-content>
            <mat-card-actions align="end" class="p-3">
              <button type="submit" mat-raised-button color="primary" [disabled]="guardando() || formularioPerfil.invalid">
                <span *ngIf="!guardando()">Guardar Cambios</span>
                <mat-progress-spinner *ngIf="guardando()" mode="indeterminate" diameter="20" class="ms-2"></mat-progress-spinner>
              </button>
            </mat-card-actions>
          </mat-card>
        </form>
      </div>

    </div>
  </div>
</div>