<div class="d-flex justify-content-center align-items-center vh-100 bg-light-subtle">
  <div class="card shadow border-0 rounded-4 text-center reset-card">

    <div *ngIf="mensajeExito()" class="vista-contenido p-4 p-md-5">
      <div class="card-header-confirmacion">
        <i class="bi bi-check-lg"></i>
      </div>
      <h2 class="fw-bold mb-2 mt-4">¡Éxito!</h2>
      <p class="text-muted mb-4">{{ mensajeExito() }}</p>
      <a routerLink="/login" class="btn btn-primary w-100 py-2">
        Ir a Iniciar Sesión Ahora
      </a>
    </div>

    <div *ngIf="!mensajeExito()" class="vista-contenido">
      <div class="card-header-custom text-white">
        <i class="bi bi-key-fill"></i>
        <h2 class="fw-bold mb-1 mt-3">Restablecer Contraseña</h2>
        <p class="opacity-75 mb-0">Ingresa tu nueva contraseña.</p>
      </div>

      <div class="card-body-custom p-4 p-md-5">
        <div *ngIf="mensajeError()" class="alert alert-danger d-flex align-items-center mb-4">
           <i class="bi bi-exclamation-triangle-fill me-2"></i>
           <div>{{ mensajeError() }}</div>
        </div>

        <form [formGroup]="resetForm" (ngSubmit)="onSubmit()">
          <div class="mb-3 text-start">
            <label for="newPassword" class="form-label fw-semibold">Nueva Contraseña</label>
            <div class="input-wrapper">
              <input id="newPassword" [type]="mostrarContrasena() ? 'text' : 'password'" class="form-control" formControlName="newPassword"
                     [class.is-invalid]="f['newPassword'].invalid && (f['newPassword'].dirty || f['newPassword'].touched)">
              <i class="bi input-icon-right toggle-password"
                 [ngClass]="mostrarContrasena() ? 'bi-eye-slash' : 'bi-eye'"
                 (click)="toggleMostrarContrasena('nueva')"></i>
            </div>
            <div *ngIf="f['newPassword'].invalid && (f['newPassword'].dirty || f['newPassword'].touched)" class="invalid-feedback d-block">
              <div *ngIf="f['newPassword'].errors?.['required']">La contraseña es requerida.</div>
              <div *ngIf="f['newPassword'].errors?.['minlength']">Mínimo 8 caracteres.</div>
              <div *ngIf="f['newPassword'].errors?.['contrasenaInsegura']" class="small">
                Debe incluir mayúscula, minúscula, número y símbolo (ej: @$!%*?&_#).
              </div>
            </div>
          </div>

          <div class="mb-4 text-start">
            <label for="confirmPassword" class="form-label fw-semibold">Confirmar Contraseña</label>
             <div class="input-wrapper">
              <input id="confirmPassword" [type]="mostrarConfirmar() ? 'text' : 'password'" class="form-control" formControlName="confirmPassword"
                     [class.is-invalid]="(f['confirmPassword'].invalid || resetForm.errors?.['mustMatch']) && (f['confirmPassword'].dirty || f['confirmPassword'].touched)">
               <i class="bi input-icon-right toggle-password"
                 [ngClass]="mostrarConfirmar() ? 'bi-eye-slash' : 'bi-eye'"
                 (click)="toggleMostrarContrasena('confirmar')"></i>
            </div>
            <div *ngIf="(f['confirmPassword'].invalid || resetForm.errors?.['mustMatch']) && (f['confirmPassword'].dirty || f['confirmPassword'].touched)" class="invalid-feedback d-block">
              <div *ngIf="f['confirmPassword'].errors?.['required']">Confirma tu contraseña.</div>
              <div *ngIf="resetForm.errors?.['mustMatch'] && !f['confirmPassword'].errors?.['required']">Las contraseñas no coinciden.</div>
            </div>
          </div>

          <button type="submit" class="btn btn-primary w-100 py-2 fw-bold mt-3" [disabled]="resetForm.invalid || cargando()">
            <span *ngIf="!cargando()">Guardar Nueva Contraseña</span>
            <span *ngIf="cargando()" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            <span *ngIf="cargando()"> Guardando...</span>
          </button>
        </form>

        <div class="mt-4">
          <a routerLink="/login" class="link-volver text-muted fw-semibold">
            Cancelar y volver a inicio de sesión
          </a>
        </div>
      </div>
    </div>

  </div>
</div>