<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0 text-gray-800">Gesti贸n de Facturaci贸n</h1>
  </div>

  <div class="row g-4">
    <div class="col-lg-7">
      <app-tabla-generica
        [data]="facturas()"
        [columnConfig]="columnasFacturacion"
        title="Listado de Facturas Emitidas"
        addButtonText="Registrar Nuevo Pago"
        [nameProperties]="['cita.paciente.nombres', 'cita.paciente.apellidos']"
        (onRowClicked)="onSeleccionarFactura($event)"
        (onAdd)="onAgregarFactura()"
        (onEdit)="onEditarFactura($event)"
        (onDelete)="onEliminarFactura($event)">
      </app-tabla-generica>
    </div>

    <div class="col-lg-5">
      <mat-card class="h-100 detail-card">
        <div *ngIf="facturaSeleccionada() as factura; else noSelection">
          <mat-card-header class="pb-3">
            <mat-icon mat-card-avatar class="detail-icon">receipt_long</mat-icon>
            <mat-card-title class="fw-bold">Detalle de la Factura</mat-card-title>
            <mat-card-subtitle>ID: {{ factura.id }}</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content class="pt-3">
            <div class="info-section">
              <h6 class="section-title">Paciente</h6>
              <p><strong>Nombre:</strong> {{ factura.cita.paciente.nombres }} {{ factura.cita.paciente.apellidos }}</p>
              <p><strong>DNI:</strong> {{ factura.cita.paciente.dni }}</p>
            </div>
            <mat-divider></mat-divider>
            
            <div class="info-section">
              <h6 class="section-title">Datos de la Factura</h6>
              <p><strong>Fecha de Emisi贸n:</strong> {{ factura.fechaEmision | date:'dd/MM/yyyy' }}</p>
              <p><strong>Estado:</strong> <span class="badge" [ngClass]="factura.estado">{{ factura.estado | titlecase }}</span></p>
            </div>
            <mat-divider></mat-divider>

            <div class="info-section">
              <h6 class="section-title">Servicios</h6>
              <div *ngIf="factura.detalles && factura.detalles.length > 0; else noDetalles">
                <table class="table table-sm details-table">
                  <thead>
                    <tr>
                      <th>Descripci贸n</th>
                      <th class="text-end">Monto</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let detalle of factura.detalles">
                      <td>{{ detalle.descripcionServicio }}</td>
                      <td class="text-end">{{ detalle.precioUnitario * detalle.cantidad | currency:'S/ ' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <ng-template #noDetalles>
                <p class="text-muted fst-italic">No hay detalles para esta factura.</p>
              </ng-template>
            </div>

            <div class="total-section text-end">
              <p class="mb-1"><strong>Monto Total:</strong> {{ factura.monto | currency:'S/ ' }}</p>
              <p class="mb-0 text-success"><strong>Monto Pagado:</strong> {{ factura.montoPagado | currency:'S/ ' }}</p>
            </div>
          </mat-card-content>

        </div>
        <ng-template #noSelection>
            <div class="no-selection-template">
              <mat-icon class="placeholder-icon">touch_app</mat-icon>
              <p class="text-muted">Seleccione una factura de la lista para ver sus detalles.</p>
            </div>
        </ng-template>
      </mat-card>
    </div>
  </div>
</div>